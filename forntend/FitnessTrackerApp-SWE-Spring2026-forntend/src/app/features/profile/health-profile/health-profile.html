<div class="page">

  <mat-card class="profile-card">
    <mat-card-header>
      <mat-card-title>Health Profile</mat-card-title>
      <mat-card-subtitle>Edit your Date of Birth, sex, height, and weight</mat-card-subtitle>
    </mat-card-header>

    <!-- Stats -->
    <app-profile-stats></app-profile-stats>

    <mat-card-content>
      <form class="form" [formGroup]="form" (ngSubmit)="save()">
        <!-- DOB -->
        <mat-form-field appearance="outline" class="full">
          <mat-label>Date of Birth</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dateOfBirth" />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="form.get('dateOfBirth')?.invalid && form.get('dateOfBirth')?.touched">
            Date of birth is required
          </mat-error>
        </mat-form-field>

        <!-- Sex -->
        <mat-form-field appearance="outline" class="full">
        <mat-label>Sex</mat-label>
        <mat-select formControlName="sex" placeholder="Select your sex">
            <mat-option value="male">Male</mat-option>
            <mat-option value="female">Female</mat-option>
            <mat-option value="other">Other</mat-option>
            <mat-option value="na">Prefer not to say</mat-option>
        </mat-select>

        <mat-error *ngIf="form.get('sex')?.invalid && form.get('sex')?.touched">
            Sex is required
        </mat-error>
        </mat-form-field>


        <!-- Height -->
        <div class="field-head">
          <div class="block-label">Height</div>
          <mat-button-toggle-group
            class="toggle"
            [value]="heightUnit"
            (change)="setHeightUnit($event.value)">
            <mat-button-toggle value="cm">cm</mat-button-toggle>
            <mat-button-toggle value="ftin">ft/in</mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <ng-container *ngIf="heightUnit === 'cm'; else heightFtIn">
          <mat-form-field appearance="outline" class="full">
            <mat-label>Height (cm)</mat-label>
            <input matInput type="number" formControlName="heightCm" />
            <mat-hint>Enter your height in centimeters</mat-hint>
          </mat-form-field>
        </ng-container>

        <ng-template #heightFtIn>
          <div class="two-col">
            <mat-form-field appearance="outline" class="full">
              <mat-label>Feet</mat-label>
              <input matInput type="number" formControlName="heightFt" min="0" step="1" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="full">
              <mat-label>Inches</mat-label>
              <input matInput type="number" formControlName="heightIn" min="0" max="11.9" step="0.1" />
            </mat-form-field>
          </div>
          <div class="hint">Enter your height in feet and inches</div>
        </ng-template>

        <!-- Weight -->
        <div class="field-head">
          <div class="block-label">Weight</div>
          <mat-button-toggle-group
            class="toggle"
            [value]="weightUnit"
            (change)="setWeightUnit($event.value)">
            <mat-button-toggle value="kg">kg</mat-button-toggle>
            <mat-button-toggle value="lbs">lbs</mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <ng-container *ngIf="weightUnit === 'kg'; else weightLbs">
          <mat-form-field appearance="outline" class="full">
            <mat-label>Weight (kg)</mat-label>
            <input matInput type="number" formControlName="weightKg" min="0" step="0.1" />
            <mat-hint>Enter your weight in kilograms</mat-hint>
          </mat-form-field>
        </ng-container>

        <ng-template #weightLbs>
          <mat-form-field appearance="outline" class="full">
            <mat-label>Weight (lbs)</mat-label>
            <input matInput type="number" formControlName="weightLbs" min="0" step="0.1" />
            <mat-hint>Enter your weight in pounds</mat-hint>
          </mat-form-field>
        </ng-template>

      <div class="field-head">
        <div class="block-label">Circumference</div>
        <mat-button-toggle-group class="toggle" [value]="circUnit" (change)="setCircUnit($event.value)">
          <mat-button-toggle value="cm">cm</mat-button-toggle>
          <mat-button-toggle value="in">in</mat-button-toggle>
        </mat-button-toggle-group>
      </div>

        <ng-container *ngIf="circUnit === 'cm'; else neckIn">
          <mat-form-field appearance="outline" class="full">
            <mat-label>Neck (cm)</mat-label>
            <input matInput type="number" [value]="displayLength(form.get('neckCm')?.value)"
          (input)="onLengthInput('neckCm', $any($event.target).value)" />
            <mat-hint>Enter your neck circumference in centimeters</mat-hint>
          </mat-form-field>
        </ng-container>

        <ng-template #neckIn>
          <mat-form-field appearance="outline" class="full">
            <mat-label>Neck (in)</mat-label>
            <input matInput type="number" [value]="displayLength(form.get('neckCm')?.value)"
          (input)="onLengthInput('neckCm', $any($event.target).value)" />
            <mat-hint>Enter your neck circumference in inches</mat-hint>
          </mat-form-field>
        </ng-template>

        <ng-container *ngIf="circUnit === 'cm'; else waistIn">
          <mat-form-field appearance="outline" class="full">
            <mat-label>Waist (cm)</mat-label>
            <input matInput type="number" [value]="displayLength(form.get('waistCm')?.value)"
          (input)="onLengthInput('waistCm', $any($event.target).value)" />
            <mat-hint>Enter your waist circumference in centimeters</mat-hint>
          </mat-form-field>
        </ng-container>

        <ng-template #waistIn>
          <mat-form-field appearance="outline" class="full">
            <mat-label>Waist (in)</mat-label>
            <input matInput type="number" [value]="displayLength(form.get('waistCm')?.value)"
          (input)="onLengthInput('waistCm', $any($event.target).value)"/>
            <mat-hint>Enter your waist circumference in inches</mat-hint>
          </mat-form-field>
        </ng-template>

      <!-- Hips: only show if sex is female (and still optional) -->
      <ng-container *ngIf="form.get('sex')?.value === 'female'">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Hips</mat-label>
          <input
            matInput
            type="number"
            [value]="displayLength(form.get('hipsCm')?.value)"
            (input)="onLengthInput('hipsCm', $any($event.target).value)"/>
          <mat-hint>Optional (only for female)</mat-hint>
        </mat-form-field>
      </ng-container>


        <button mat-raised-button color="primary" class="primary-btn" type="submit">
          Save
        </button>

        <div class="saved" *ngIf="savedMsg">{{ savedMsg }}</div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
